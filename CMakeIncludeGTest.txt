find_package(Threads REQUIRED)

# Enable ExternalProject CMake module
include(ExternalProject)

# Configure the project for testing
include(CTest)

ExternalProject_Add(googletest   # Name for custom target

  GIT_REPOSITORY https://github.com/google/googletest.git

  GIT_TAG master

  # Never update automatically from the remote repository
  UPDATE_DISCONNECTED 1

  PATCH_COMMAND echo "add_subdirectory(googlemock)" > CMakeLists.txt

  INSTALL_COMMAND ""
)

ExternalProject_Get_Property(googletest source_dir)
MESSAGE(STATUS "google source_dir is:\n " ${source_dir} )


add_library(libgmock IMPORTED STATIC GLOBAL)
add_dependencies(libgmock googletest)

# Set gmock properties
ExternalProject_Get_Property(googletest source_dir binary_dir)
set_target_properties(libgmock PROPERTIES
    "IMPORTED_LOCATION" "${binary_dir}/googlemock/libgmock.a"
    "IMPORTED_LINK_INTERFACE_LIBRARIES" "${CMAKE_THREAD_LIBS_INIT}"
#    "INTERFACE_INCLUDE_DIRECTORIES" "${source_dir}/include"
)


include_directories("${source_dir}/googletest/include/")
include_directories("${source_dir}/googlemock/include/")
